<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rekomendasi Jurusan (Backward + Fallback)</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-blue-100 min-h-screen flex items-center justify-center p-6">
  <div class="bg-white p-8 rounded-xl shadow-xl max-w-xl w-full text-center">
    <h1 class="text-3xl font-bold text-purple-700 mb-4">Halo, <span id="nama"></span>!</h1>
    <h2 class="text-xl mb-6 font-semibold text-gray-800">Rekomendasi Jurusan Terbaik Untukmu:</h2>
    <p class="text-2xl font-bold text-blue-600" id="hasil">Memproses...</p>
    <p class="mt-4 text-gray-600" id="alasan"></p>
    <div class="mt-6" id="fallbackSection"></div>
    <a href="index.html" class="inline-block mt-8 px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">Kembali</a>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const nama = params.get("nama") || "Teman";
    const minat = params.get("minat");
    const kepribadian = params.get("kepribadian");
    const gayaBelajar = params.get("gaya_belajar");
    const nilaiUnggulan = params.get("nilai_unggulan");

    document.getElementById("nama").textContent = nama;

    const goals = [
      {
        jurusan: "Teknik Informatika",
        syarat: {
          minat: "teknologi",
          kepribadian: "introvert",
          gayaBelajar: "praktik",
          nilaiUnggulan: "matematika",
        },
        alasan: "Karena kamu menyukai teknologi, belajar praktik, dan unggul dalam matematika.",
      },
      {
        jurusan: "Sistem Informasi",
        syarat: {
          minat: "teknologi",
          kepribadian: "ekstrovert",
          gayaBelajar: "kolaboratif",
          nilaiUnggulan: "matematika",
        },
        alasan: "Kamu menyukai teknologi dan bekerja dalam tim dengan kemampuan matematika yang baik.",
      },
      {
        jurusan: "DKV (Desain Komunikasi Visual)",
        syarat: {
          minat: "seni",
          kepribadian: "ekstrovert",
          gayaBelajar: "praktik",
          nilaiUnggulan: "seni",
        },
        alasan: "Kamu ekspresif, suka seni, dan belajar dengan praktik langsung.",
      },
      {
        jurusan: "Psikologi",
        syarat: {
          minat: "sosial",
          kepribadian: "introvert",
          gayaBelajar: "teori",
          nilaiUnggulan: "bahasa",
        },
        alasan: "Kamu suka memahami manusia dan unggul dalam teori dan bahasa.",
      },
      {
        jurusan: "Farmasi",
        syarat: {
          minat: "kesehatan",
          kepribadian: "introvert",
          gayaBelajar: "praktik",
          nilaiUnggulan: "biologi",
        },
        alasan: "Kamu suka praktik dan unggul dalam ilmu biologi serta kesehatan.",
      },
      {
        jurusan: "Hubungan Internasional",
        syarat: {
          minat: "sosial",
          kepribadian: "ekstrovert",
          gayaBelajar: "praktik",
          nilaiUnggulan: "bahasa",
        },
        alasan: "Kamu sosial, suka praktik, dan pandai berbahasa.",
      }
    ];

    let jurusanDitemukan = null;

    // Backward chaining utama (semua syarat cocok)
    for (const goal of goals) {
      const s = goal.syarat;
      if (
        s.minat === minat &&
        s.kepribadian === kepribadian &&
        s.gayaBelajar === gayaBelajar &&
        s.nilaiUnggulan === nilaiUnggulan
      ) {
        jurusanDitemukan = goal;
        break;
      }
    }

    const hasilElem = document.getElementById("hasil");
    const alasanElem = document.getElementById("alasan");
    const fallbackElem = document.getElementById("fallbackSection");

    if (jurusanDitemukan) {
      hasilElem.textContent = jurusanDitemukan.jurusan;
      alasanElem.textContent = jurusanDitemukan.alasan;
    } else {
      hasilElem.textContent = "Belum ada jurusan yang 100% cocok.";
      alasanElem.textContent = "Namun berikut beberapa jurusan yang mendekati pilihanmu:";

      // Fallback: cari jurusan dengan minimal 2 kecocokan
      const fallbackList = goals.map(goal => {
        const s = goal.syarat;
        let score = 0;
        if (s.minat === minat) score++;
        if (s.kepribadian === kepribadian) score++;
        if (s.gayaBelajar === gayaBelajar) score++;
        if (s.nilaiUnggulan === nilaiUnggulan) score++;
        return { ...goal, score };
      }).filter(item => item.score >= 2) // minimal 2 kecocokan
        .sort((a, b) => b.score - a.score);

      if (fallbackList.length > 0) {
        const listHTML = fallbackList.map(item => `
          <div class="mt-4 text-left">
            <h3 class="text-lg font-semibold text-blue-700">${item.jurusan}</h3>
            <p class="text-sm text-gray-600">${item.alasan} (Kecocokan: ${item.score}/4)</p>
          </div>
        `).join('');
        fallbackElem.innerHTML = listHTML;
      } else {
        fallbackElem.innerHTML = `<p class="text-red-600 mt-4">Belum ada jurusan yang mendekati kriteria kamu.</p>`;
      }
    }
  </script>
</body>
</html>
